# 情報設計・導線再設計ドキュメント

## 1. ゴールと設計原則
- **経営判断を支える即時性**：トップ画面にKGI直結の主要KPIを集約し、どのタブでも同じ階層（トレンド→構成比→明細）で素早く掘り下げられるようにする。
- **データ取込からレポート出力までの一貫導線**：Importウィザード、設定・シミュレーション、レポート出力が途切れずに連携する導線を用意する。
- **異常値・変動の可視化**：全ての主要指標でYoYや前期比を明示し、矢印や色で直感的に判断できるようにする。

## 2. サイトマップ / 画面構造
```
Dashboard (トップ)
 ├─ タブ: 売上 / 粗利 / 在庫 / 資金
 │    ├─ トレンド（12ヶ月移動累計 + YoY）
 │    ├─ 構成比（カテゴリ別/チャネル別）
 │    └─ 明細テーブル（項目 / 金額 / 前期比 / 注記）
 ├─ KPIカード（売上合計・粗利・キャッシュフロー）
 ├─ フィルター（期間、店舗、その他ディメンション）
 └─ エクスポート（CSV / PDF）

Data Import ウィザード
 ├─ Step1: テンプレート選択
 ├─ Step2: データアップロード
 ├─ Step3: データチェック（バリデーション結果）
 └─ Step4: 完了（次のアクション提示 + サンプルデータ利用ボタン）

設定・シミュレーション
 ├─ 閾値設定（アラート、YoY、在庫上下限など）
 ├─ 予算・シナリオ登録（複数シナリオ管理）
 ├─ シナリオ比較グラフ（ベース vs シナリオ、主要KPI重ね合わせ）
 └─ 設定履歴ログ

レポート出力
 ├─ 条件選択（期間、店舗、指標、シナリオ）
 ├─ ワンクリック出力（PDF / CSV）
 └─ 出力ログ（過去出力の履歴・ダウンロードリンク）
```

## 3. グローバル導線
- 左側ナビゲーションに「ダッシュボード」「データ取込」「設定・シミュレーション」「レポート」を配置し、常にアクセス可能にする。
- 右上ユーティリティとして「通知（アラート）」「ユーザー設定」「ヘルプ」を配置。
- KPIカードから該当タブへダイレクトリンク（例：粗利カードをクリックすると粗利タブにジャンプ）。

## 4. タブ共通レイアウト仕様
| レイヤー | 表示要素 | 詳細 | 補足 |
|-----------|----------|------|------|
| KPIヘッダー | 選択タブに応じた主要KPI（例：売上タブなら売上高、客数、客単価） | 数値・前期比・矢印表示。カード型。 | カードはホバーで詳細（期間、計算式）。 |
| トレンド領域 | 12ヶ月移動累計の折れ線グラフ + 前年同月比ライン | KPI毎に色を分け、カーソルホバーで具体値を表示。 | グラフ右上に単位・凡例切替。 |
| 構成比領域 | 積み上げ棒グラフまたはドーナツグラフ | 商品カテゴリ/チャネル/地域など切替タブを上部に配置。 | グラフ下に構成比トップ3をカード表示。 |
| 明細テーブル | 項目 / 金額 / 前期比 / 注記 | 縦スクロール、列ソート、単位表示、桁区切り。 | 行クリックで詳細モーダル。 |
| 追加アクション | 「CSV/PDF出力」「ビュー保存」「シェア」 | タブ共通の右上アクションバーにまとめる。 | ビュー保存時はフィルター条件も保持。 |

## 5. データ取込（Import）導線
1. **テンプレート選択**：業種別テンプレート一覧 + 説明。サンプルデータ利用ボタンをここに常設。
2. **データアップロード**：ドラッグ＆ドロップ + ファイル選択。アップロード後にプレビュー表を表示。
3. **データチェック**：必須列・型の検証結果、エラー行のダウンロードリンク、警告は修正方法を表示。
4. **完了**：正常終了メッセージと次に行うアクション（例：ダッシュボードへ移動、シナリオ設定へ）。進捗バーは常に画面上部に表示し、現在ステップを強調。

## 6. 設定・シミュレーション画面
- **閾値設定**：アラート条件（YoY閾値、粗利率下限、在庫日数上限）をカード形式で配置。即時に影響範囲がプレビューに反映。
- **シナリオ設定**：シナリオ名、期間、予算金額、調整率などを入力するフォームを用意。シナリオごとにカラーを割当て。
- **比較ビュー**：主要KPIを3枚のグラフ（売上・粗利・キャッシュ）で並列表示。ベースラインとの乖離を面グラフで表示。
- **アクション履歴**：誰がいつ設定を変更したかのログをテーブルで表示。

## 7. レポート出力
- 条件パネルで期間・店舗・対象指標・シナリオを指定。
- 「PDF出力」「CSV出力」をワンクリックで実行。サーバー処理中はスピナーとステータスを表示。
- 出力結果にはフィルター条件をヘッダーとして埋め込み、ドキュメントにも明記。
- 過去出力の履歴をテーブルで保持し、再ダウンロード可能にする。

## 8. トップ画面情報優先度マトリクス
| 重要度 | コンテンツ | 表示方法 | 補足 |
|--------|-------------|----------|------|
| 非常に高 | 売上・粗利・キャッシュ（KGI直結） | 大型数値カード。フォント特大、矢印と前期比（▲▼）表示。 | 色：上昇=ブルー、下降=オレンジ。ホバーで詳細。 |
| 高 | トレンドグラフ（12ヶ月移動累計） | 折れ線グラフ + 前年同月比ライン。 | 区間ズーム、閾値表示ラインを追加可能。 |
| 中 | 構成比（商品カテゴリ別、チャネル別） | 積み上げ棒グラフ。 | セグメント切替タブを設置。 |
| 低 | 明細テーブル | スクロール可能な表。桁区切りと単位表記を固定ヘッダーに表示。 | 行ピン留め・CSV出力可。 |

## 9. トップ画面ワイヤーフレーム（テキスト）
```
┌──────────────────────────────────────────────┐
│ KPIカード:  売上合計  ▲5%  ↗  |  粗利  ▼3%  ↘  |  現金  ▲8%  ↗            │
├──────────────────────────────────────────────┤
│ フィルター: 期間[ 今月 ▼ ]  店舗[ 全店 ▼ ]  チャネル[ 全チャネル ▼ ]  │
│ 右上アクション: [ CSV出力 ] [ PDF出力 ] [ ビュー保存 ]                    │
├──────────────────────────────────────────────┤
│ タブ: [ 売上 ] [ 粗利 ] [ 在庫 ] [ 資金 ]                                   │
├──────────────────────────────────────────────┤
│ トレンド折れ線グラフ（12ヶ月移動累計 + YoYライン）                        │
├──────────────────────────────────────────────┤
│ 構成比グラフ（商品カテゴリ別/チャネル別の積み上げ棒）                     │
├──────────────────────────────────────────────┤
│ 明細テーブル：項目 | 金額 | 前期比 | 注記（スクロール可、列ソート）        │
└──────────────────────────────────────────────┘
```

## 10. 連携導線のハイライト
- ダッシュボードから「データが古い」アラートをクリックするとImportウィザードStep2へ遷移。
- KPIカード右上の「シナリオ比較」リンクから設定・シミュレーション画面の該当シナリオを開く。
- 明細テーブルの行アクション「レポート出力」を押すとレポート出力画面に遷移し、行の条件が自動入力される。

## 11. 次ステップ（UIデザインへの落とし込み）
1. KPIカード・グラフ・テーブルのコンポーネント仕様（カラー、タイポグラフィ、余白）をDESIGN_SYSTEM.mdと整合させる。
2. 各タブで使うフィルター項目の定義とAPI設計をサービスチームと合意する。
3. Importウィザードのバリデーションルールとエラーメッセージ一覧を作成する。
4. レポート出力PDFのフォーマット（紙面サイズ、ヘッダー/フッター）とCSVカラム仕様を確定する。
